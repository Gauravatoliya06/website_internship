<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Water Quality Dashboard</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .dashboard {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            position: relative; /* Required for absolute positioning of children */
            padding-top: 10px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            /* Make room for menu button on small screens if needed */
            padding-left: 60px;
            padding-right: 60px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        /* --- NEW MENU STYLES --- */
        .menu-container {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 1000;
        }

        .menu-toggle-btn {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            font-size: 1.8em; /* Adjusted size for vertical dots */
            font-weight: bold;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            line-height: 45px; /* Fine-tune vertical alignment */
            padding: 0;
            transition: all 0.3s ease;
        }

        .menu-toggle-btn:hover {
            background: rgba(255, 255, 255, 0.4);
            transform: translateY(-2px);
        }

        .dropdown-menu {
            display: none; /* Hidden by default */
            position: absolute;
            top: 65px; /* Below the button */
            left: 0;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.15);
            min-width: 280px;
            overflow: hidden;
            animation: fadeInMenu 0.2s ease-out;
        }

        .dropdown-menu.show {
            display: block; /* Show menu */
        }

        @keyframes fadeInMenu {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .menu-item {
            display: block;
            width: 100%;
            padding: 18px 25px;
            background: none;
            border: none;
            border-bottom: 1px solid rgba(0,0,0,0.05);
            text-align: left;
            font-size: 1.1em;
            color: #333;
            cursor: pointer;
            font-weight: 600;
        }
        
        .menu-item:last-child {
            border-bottom: none;
        }

        .menu-item:hover {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
        }
        /* --- END NEW MENU STYLES --- */


        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .controls {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            align-items: center;
        }

        .control-group {
            display: flex;
            flex-direction: column;
        }

        .control-group label {
            color: white;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .control-group select, .control-group input {
            padding: 10px;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.9);
            font-size: 14px;
        }

        .refresh-btn {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: transform 0.2s;
        }

        .refresh-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .metric-card:hover {
            transform: translateY(-5px);
        }

        .metric-value {
            font-size: 2.5em;
            font-weight: bold;
            margin: 15px 0;
        }

        .metric-label {
            font-size: 1.1em;
            color: #666;
            margin-bottom: 10px;
        }

        .metric-unit {
            font-size: 0.9em;
            color: #888;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-left: 10px;
        }

        .status-safe { background-color: #4CAF50; }
        .status-caution { background-color: #FF9800; }
        .status-danger { background-color: #F44336; }

        .ph { color: #2196F3; }
        .oxygen { color: #4CAF50; }
        .turbidity { color: #FF9800; }
        .bacteria { color: #9C27B0; }
        .heavy-metal { color: #795548; }
        .chemical { color: #607D8B; }

        .charts-section {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .chart-title {
            font-size: 1.3em;
            margin-bottom: 20px;
            color: #333;
            text-align: center;
            font-weight: 600;
        }

        .alerts-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .alert-item {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .alert-warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
        }

        .alert-danger {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
        }

        .alert-info {
            background: #d1ecf1;
            border-left: 4px solid #17a2b8;
        }

        .alert-icon {
            font-size: 1.2em;
            font-weight: bold;
        }

        .locations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .location-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .location-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .location-name {
            font-size: 1.2em;
            font-weight: 600;
            color: #333;
        }

        .wqi-score {
            font-size: 1.5em;
            font-weight: bold;
            padding: 8px 15px;
            border-radius: 20px;
            color: white;
        }

        .wqi-excellent { background: #4CAF50; }
        .wqi-good { background: #8BC34A; }
        .wqi-fair { background: #FF9800; }
        .wqi-poor { background: #F44336; }

        .mini-metrics {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .mini-metric {
            text-align: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .mini-metric-value {
            font-weight: bold;
            font-size: 1.1em;
        }

        .mini-metric-label {
            font-size: 0.8em;
            color: #666;
            margin-top: 5px;
        }

        .report-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .report-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .report-btn {
            background: linear-gradient(45deg, #2196F3, #1976D2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .report-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .report-btn.download {
            background: linear-gradient(45deg, #4CAF50, #45a049);
        }

        .report-btn.email {
            background: linear-gradient(45deg, #FF9800, #F57C00);
        }

        .report-preview {
            background: #f8f9fa;
            border: 2px dashed #ddd;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            margin-top: 15px;
        }

        .report-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .summary-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .summary-number {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .footer {
            text-align: center;
            color: rgba(255, 255, 255, 0.8);
            margin-top: 30px;
            padding: 20px;
        }

        @media (max-width: 768px) {
            .charts-section {
                grid-template-columns: 1fr;
            }
            
            .dashboard {
                padding: 10px;
            }
            
            .metric-value {
                font-size: 2em;
            }

            /* Adjust header for small screens */
            .header h1 {
                font-size: 1.8em;
                padding-left: 0;
                padding-right: 0;
                margin-top: 60px; /* Make space for menu button */
            }

            .header p {
                font-size: 1em;
            }

            .menu-container {
                left: 10px;
                top: 10px;
            }
        }

        .loading {
            display: inline-block;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <header class="header">
            
            <div class="menu-container">
                <button id="menu-toggle" class="menu-toggle-btn">‚ãÆ</button>
                <div id="main-menu" class="dropdown-menu">
                    <button class="menu-item" data-tab="dashboard" data-title="üåä Water Quality Monitoring Dashboard">üìä Dashboard</button>
                    <button class="menu-item" data-tab="monitoring" data-title="üìç Live Monitoring Stations">üìç Monitoring</button>
                    <button class="menu-item" data-tab="reports" data-title="üìÑ Report Generator">üìÑ Reports</button>
                    <button class="menu-item" data-tab="analytics" data-title="üìà Advanced Analytics">üìà Analytics</button>
                    <button class="menu-item" data-tab="alerts" data-title="üö® System Alerts">üö® Alerts</button>
                    <button class="menu-item" data-tab="settings" data-title="‚öôÔ∏è Dashboard Settings">‚öôÔ∏è Settings</button>
                    <button class="menu-item" data-tab="help" data-title="‚ùì Help & Documentation">‚ùì Help</button>
                </div>
            </div>

            <h1 id="dashboard-title">üåä Water Quality Monitoring Dashboard</h1>
            <p>Real-time water quality data and environmental monitoring</p>
            
            </header>

        <div id="dashboard" class="tab-content active">

            <div class="controls">
                <div class="controls-grid">
                    <div class="control-group">
                        <label>Location</label>
                        <select id="locationSelect">
                            <option value="all">All Locations</option>
                            <option value="jaipur">Jaipur District</option>
                            <option value="jodhpur">Jodhpur District</option>
                            <option value="udaipur">Udaipur District</option>
                            <option value="kota">Kota District</option>
                            <option value="ajmer">Ajmer District</option>
                            <option value="bikaner">Bikaner District</option>
                            <option value="alwar">Alwar District</option>
                            <option value="bharatpur">Bharatpur District</option>
                            <option value="pali">Pali District</option>
                            <option value="nagaur">Nagaur District</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>Time Range</label>
                        <select id="timeRange">
                            <option value="24h">Last 24 Hours</option>
                            <option value="7d">Last 7 Days</option>
                            <option value="30d">Last 30 Days</option>
                            <option value="3m">Last 3 Months</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>Date From</label>
                        <input type="date" id="dateFrom">
                    </div>
                    <div class="control-group">
                        <label>Date To</label>
                        <input type="date" id="dateTo">
                    </div>
                    <div class="control-group">
                        <button class="refresh-btn"> <span id="refreshIcon">üîÑ</span> Refresh Data
                        </button>
                    </div>
                </div>
            </div>
    
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-label">pH Level</div>
                    <div class="metric-value ph" id="phValue">7.2</div>
                    <div class="metric-unit">pH units <span class="status-indicator status-safe"></span></div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Dissolved Oxygen</div>
                    <div class="metric-value oxygen" id="oxygenValue">8.5</div>
                    <div class="metric-unit">mg/L <span class="status-indicator status-safe"></span></div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Turbidity</div>
                    <div class="metric-value turbidity" id="turbidityValue">2.3</div>
                    <div class="metric-unit">NTU <span class="status-indicator status-caution"></span></div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Temperature</div>
                    <div class="metric-value temperature" id="tempValue">22.1</div>
                    <div class="metric-unit">¬∞C <span class="status-indicator status-safe"></span></div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">E. Coli</div>
                    <div class="metric-value bacteria" id="ecoliValue">15</div>
                    <div class="metric-unit">CFU/100ml <span class="status-indicator status-safe"></span></div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Total Coliform</div>
                    <div class="metric-value bacteria" id="coliformValue">45</div>
                    <div class="metric-unit">CFU/100ml <span class="status-indicator status-caution"></span></div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Total Metals</div>
                    <div class="metric-value heavy-metal" id="metalsValue">2.8</div>
                    <div class="metric-unit">Œºg/L <span class="status-indicator status-safe"></span></div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Nitrates</div>
                    <div class="metric-value chemical" id="nitratesValue">8.2</div>
                    <div class="metric-unit">mg/L <span class="status-indicator status-safe"></span></div>
                </div>
            </div>
    
            <div class="charts-section">
                <div class="chart-container">
                    <h3 class="chart-title">Water Quality Trends (Last 7 Days)</h3>
                    <canvas id="trendsChart"></canvas>
                </div>
                <div class="alerts-section">
                    <h3 class="chart-title">System Alerts</h3>
                    <div class="alert-item alert-danger">
                        <div class="alert-icon">‚ò£Ô∏è</div>
                        <div>
                            <strong>High Contamination Zone</strong><br>
                            Groundwater Well 3: Multiple contaminants<br>
                            <small>2 hours ago</small>
                        </div>
                    </div>
                    <div class="alert-item alert-danger">
                        <div class="alert-icon">ü¶†</div>
                        <div>
                            <strong>Bacterial Contamination</strong><br>
                            River Station 1: E. Coli 145 CFU/100ml<br>
                            <small>30 minutes ago</small>
                        </div>
                    </div>
                    <div class="alert-item alert-warning">
                        <div class="alert-icon">‚ö†Ô∏è</div>
                        <div>
                            <strong>High Turbidity</strong><br>
                            Lake Monitor A: 4.2 NTU<br>
                            <small>2 hours ago</small>
                        </div>
                    </div>
                    <div class="alert-item alert-danger">
                        <div class="alert-icon">‚ò¢Ô∏è</div>
                        <div>
                            <strong>Metal Contamination Alert</strong><br>
                            Groundwater Well 3: Metals 18.5 Œºg/L<br>
                            <small>4 hours ago</small>
                        </div>
                    </div>
                    <div class="alert-item alert-warning">
                        <div class="alert-icon">üß™</div>
                        <div>
                            <strong>Chemical Contamination</strong><br>
                            Lake Monitor A: Nitrates 12.8 mg/L<br>
                            <small>5 hours ago</small>
                        </div>
                    </div>
                </div>
            </div>

        </div>
        <div id="monitoring" class="tab-content">
            <div class="controls">
                <h3 style="color: white; margin-bottom: 15px;">üìç Live Monitoring Stations</h3>
            </div>
            
            <div style="margin-top: 30px;">
                <h3 class="chart-title" style="color: white; text-align: center; margin-bottom: 20px;">Rajasthan Districts - Water Quality Monitoring</h3>
                <div class="locations-grid">
                    <div class="location-card">
                        <div class="location-header">
                            <div class="location-name">üèõÔ∏è Jaipur District</div>
                            <div class="wqi-score wqi-good">78</div>
                        </div>
                        <div style="color: #666; margin-bottom: 10px;">Last updated: 10 minutes ago</div>
                        <div class="mini-metrics">
                            <div class="mini-metric">
                                <div class="mini-metric-value" style="color: #2196F3;">7.2</div>
                                <div class="mini-metric-label">pH</div>
                            </div>
                            <div class="mini-metric">
                                <div class="mini-metric-value" style="color: #4CAF50;">8.8</div>
                                <div class="mini-metric-label">DO (mg/L)</div>
                            </div>
                            <div class="mini-metric">
                                <div class="mini-metric-value" style="color: #FF9800;">2.1</div>
                                <div class="mini-metric-label">Turbidity</div>
                            </div>
                            <div class="mini-metric">
                                <div class="mini-metric-value" style="color: #9C27B0;">25</div>
                                <div class="mini-metric-label">E.Coli</div>
                            </div>
                            <div class="mini-metric">
                                <div class="mini-metric-value" style="color: #795548;">2.8</div>
                                <div class="mini-metric-label">Metals (Œºg/L)</div>
                            </div>
                            <div class="mini-metric">
                                <div class="mini-metric-value" style="color: #607D8B;">7.5</div>
                                <div class="mini-metric-label">Nitrates</div>
                            </div>
                        </div>
                    </div>

                    <div class="location-card">
                        <div class="location-header">
                            <div class="location-name">üèúÔ∏è Jodhpur District</div>
                            <div class="wqi-score wqi-fair">65</div>
                        </div>
                        <div style="color: #666; margin-bottom: 10px;">Last updated: 45 minutes ago</div>
                        <div class="mini-metrics">
                            <div class="mini-metric">
                                <div class="mini-metric-value" style="color: #2196F3;">8.1</div>
                                <div class="mini-metric-label">pH</div>
                            </div>
                            <div class="mini-metric">
                                <div class="mini-metric-value" style="color: #4CAF50;">7.2</div>
                                <div class="mini-metric-label">DO (mg/L)</div>
                            </div>
                            <div class="mini-metric">
                                <div class="mini-metric-value" style="color: #FF9800;">4.5</div>
                                <div class="mini-metric-label">Turbidity</div>
                            </div>
                            <div class="mini-metric">
                                <div class="mini-metric-value" style="color: #9C27B0;">80</div>
                                <div class="mini-metric-label">Coliform</div>
                            </div>
                            <div class="mini-metric">
                                <div class="mini-metric-value" style="color: #795548;">5.2</div>
                                <div class="mini-metric-label">Metals (Œºg/L)</div>
                            </div>
                            <div class="mini-metric">
                                <div class="mini-metric-value" style="color: #607D8B;">11.8</div>
                                <div class="mini-metric-label">Nitrates</div>
                            </div>
                        </div>
                    </div>

                    <div class="location-card">
                        <div class="location-header">
                            <div class="location-name">üèûÔ∏è Udaipur District</div>
                            <div class="wqi-score wqi-excellent">89</div>
                        </div>
                        <div style="color: #666; margin-bottom: 10px;">Last updated: 20 minutes ago</div>
                        <div class="mini-metrics">
                            <div class="mini-metric">
                                <div class="mini-metric-value" style="color: #2196F3;">7.4</div>
                                <div class="mini-metric-label">pH</div>
                            </div>
                            <div class="mini-metric">
                                <div class="mini-metric-value" style="color: #4CAF50;">9.1</div>
                                <div class="mini-metric-label">DO (mg/L)</div>
                            </div>
                            <div class="mini-metric">
                                <div class="mini-metric-value" style="color: #FF9800;">1.2</div>
                                <div class="mini-metric-label">Turbidity</div>
                            </div>
                            <div class="mini-metric">
                                <div class="mini-metric-value" style="color: #9C27B0;">8</div>
                                <div class="mini-metric-label">E.Coli</div>
                            </div>
                            <div class="mini-metric">
                                <div class="mini-metric-value" style="color: #795548;">0.8</div>
                                <div class="mini-metric-label">Metals (Œºg/L)</div>
                            </div>
                            <div class="mini-metric">
                                <div class="mini-metric-value" style="color: #607D8B;">5.2</div>
                                <div class="mini-metric-label">Nitrates</div>
                            </div>
                        </div>
                    </div>

                    <div class="location-card">
                        <div class="location-header">
                            <div class="location-name">üè≠ Kota District</div>
                            <div class="wqi-score wqi-poor">42</div>
                        </div>
                        <div style="color: #666; margin-bottom: 10px;">Last updated: 1 hour ago</div>
                        <div class="mini-metrics">
                            <div class="mini-metric">
                                <div class="mini-metric-value" style="color: #2196F3;">6.1</div>
                                <div class="mini-metric-label">pH</div>
                            </div>
                            <div class="mini-metric">
                                <div class="mini-metric-value" style="color: #4CAF50;">5.8</div>
                                <div class="mini-metric-label">DO (mg/L)</div>
                            </div>
                            <div class="mini-metric">
                                <div class="mini-metric-value" style="color: #FF9800;">8.9</div>
                                <div class="mini-metric-label">Turbidity</div>
                            </div>
                            <div class="mini-metric">
                                <div class="mini-metric-value" style="color: #9C27B0;">185</div>
                                <div class="mini-metric-label">E.Coli</div>
                            </div>
                            <div class="mini-metric">
                                <div class="mini-metric-value" style="color: #795548;">16.8</div>
                                <div class="mini-metric-label">Metals (Œºg/L)</div>
                            </div>
                            <div class="mini-metric">
                                <div class="mini-metric-value" style="color: #F44336;">25.2</div>
                                <div class="mini-metric-label">Temp (¬∞C)</div>
                            </div>
                        </div>
                    </div>
                     <div class="location-card">
                        <div class="location-header">
                            <div class="location-name">üïå Ajmer District</div>
                            <div class="wqi-score wqi-good">72</div>
                        </div>
                        <div style="color: #666; margin-bottom: 10px;">Last updated: 30 minutes ago</div>
                        <div class="mini-metrics">
                            <div class="mini-metric">
                                <div class="mini-metric-value" style="color: #2196F3;">7.6</div>
                                <div class="mini-metric-label">pH</div>
                            </div>
                            <div class="mini-metric">
                                <div class="mini-metric-value" style="color: #4CAF50;">8.4</div>
                                <div class="mini-metric-label">DO (mg/L)</div>
                            </div>
                            <div class="mini-metric">
                                <div class="mini-metric-value" style="color: #FF9800;">2.8</div>
                                <div class="mini-metric-label">Turbidity</div>
                            </div>
                            <div class="mini-metric">
                                <div class="mini-metric-value" style="color: #9C27B0;">45</div>
                                <div class="mini-metric-label">Coliform</div>
                            </div>
                            <div class="mini-metric">
                                <div class="mini-metric-value" style="color: #795548;">3.5</div>
                                <div class="mini-metric-label">Metals (Œºg/L)</div>
                            </div>
                            <div class="mini-metric">
                                <div class="mini-metric-value" style="color: #607D8B;">8.9</div>
                                <div class="mini-metric-label">Nitrates</div>
                            </div>
                        </div>
                    </div>

                    <div class="location-card">
                        <div class="location-header">
                            <div class="location-name">üê™ Bikaner District</div>
                            <div class="wqi-score wqi-fair">58</div>
                        </div>
                        <div style="color: #666; margin-bottom: 10px;">Last updated: 2 hours ago</div>
                        <div class="mini-metrics">
                            <div class="mini-metric">
                                <div class="mini-metric-value" style="color: #2196F3;">8.3</div>
                                <div class="mini-metric-label">pH</div>
                            </div>
                            <div class="mini-metric">
                                <div class="mini-metric-value" style="color: #4CAF50;">6.8</div>
                                <div class="mini-metric-label">DO (mg/L)</div>
                            </div>
                            <div class="mini-metric">
                                <div class="mini-metric-value" style="color: #FF9800;">6.2</div>
                                <div class="mini-metric-label">Turbidity</div>
                            </div>
                            <div class="mini-metric">
                                <div class="mini-metric-value" style="color: #9C27B0;">95</div>
                                <div class="mini-metric-label">E.Coli</div>
                            </div>
                            <div class="mini-metric">
                                <div class="mini-metric-value" style="color: #795548;">7.8</div>
                                <div class="mini-metric-label">Metals (Œºg/L)</div>
                            </div>
                            <div class="mini-metric">
                                <div class="mini-metric-value" style="color: #F44336;">22.8</div>
                                <div class="mini-metric-label">Temp (¬∞C)</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="reports" class="tab-content">
            <div class="report-section">
                <h3 class="chart-title">üìä Water Quality Report Generator</h3>
                
                <div class="report-controls">
                    <div class="control-group">
                        <label>Report Type</label>
                        <select id="reportType">
                            <option value="summary">Summary Report</option>
                            <option value="detailed">Detailed Analysis</option>
                            <option value="contamination">Contamination Report</option>
                            <option value="compliance">Compliance Report</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>District Selection</label>
                        <select id="reportLocation">
                            <option value="all">All Districts</option>
                            <option value="jaipur">Jaipur District</option>
                            <option value="jodhpur">Jodhpur District</option>
                            <option value="udaipur">Udaipur District</option>
                            <option value="kota">Kota District</option>
                            <option value="ajmer">Ajmer District</option>
                            <option value="bikaner">Bikaner District</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>Report Period</label>
                        <select id="reportPeriod">
                            <option value="daily">Daily Report</option>
                            <option value="weekly">Weekly Report</option>
                            <option value="monthly">Monthly Report</option>
                            <option value="quarterly">Quarterly Report</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>Format</label>
                        <select id="reportFormat">
                            <option value="pdf">PDF Report</option>
                            <option value="excel">Excel Spreadsheet</option>
                            <option value="csv">CSV Data</option>
                            <option value="json">JSON Data</option>
                        </select>
                    </div>
                </div>

                <div style="display: flex; gap: 15px; flex-wrap: wrap; margin-bottom: 20px;">
                    <button class="report-btn"> üìÑ Generate Report
                    </button>
                    <button class="report-btn download"> üíæ Download Report
                    </button>
                    <button class="report-btn email"> üìß Email Report
                    </button>
                </div>

                <div class="report-summary">
                    <div class="summary-card">
                        <div class="summary-number" style="color: #4CAF50;">7</div>
                        <div class="summary-label">Safe Districts</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-number" style="color: #FF9800;">2</div>
                        <div class="summary-label">Caution Districts</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-number" style="color: #F44336;">1</div>
                        <div class="summary-label">High Risk Districts</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-number" style="color: #2196F3;">50</div>
                        <div class="summary-label">Total Monitoring Points</div>
                    </div>
                </div>

                <div class="report-preview" id="reportPreview">
                    <h4>üìã Report Preview</h4>
                    <p style="color: #666; margin-top: 10px;">
                        Select report parameters above and click "Generate Report" to preview your water quality report.
                    </p>
                    <div id="previewContent" style="display: none;">
                        <div style="text-align: left; margin-top: 15px;">
                            <strong>Water Quality Report - Rajasthan</strong><br>
                            <span id="reportTitle">Summary Report for All Districts</span><br>
                            <span id="reportDate">Generated on: </span><br><br>
                            
                            <div id="reportStats" style="background: white; padding: 15px; border-radius: 8px; margin: 10px 0;">
                                </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="analytics" class="tab-content">
            <div class="controls">
                <h3 style="color: white; margin-bottom: 15px;">üìà Advanced Analytics & Insights</h3>
            </div>
            
            <div class="chart-container" style="margin-bottom: 30px;">
                <h3 class="chart-title">Trend Analysis - Last 30 Days</h3>
                <canvas id="analyticsChart"></canvas>
            </div>

            <div class="chart-container" style="margin-bottom: 30px;">
                <h3 class="chart-title">Water Test Results by Rajasthan Districts</h3>
                <canvas id="locationChart"></canvas>
            </div>

            <div class="chart-container" style="margin-bottom: 30px;">
                <h3 class="chart-title">Parameter Distribution (Overall WQI)</h3>
                <canvas id="distributionChart"></canvas>
            </div>

            <div class="report-summary">
                <div class="summary-card">
                    <div class="summary-number" style="color: #2196F3;">+12%</div>
                    <div class="summary-label">Water Quality Improvement</div>
                </div>
                <div class="summary-card">
                    <div class="summary-number" style="color: #4CAF50;">85%</div>
                    <div class="summary-label">Compliance Rate</div>
                </div>
                <div class="summary-card">
                    <div class="summary-number" style="color: #FF9800;">-8%</div>
                    <div class="summary-label">Contamination Incidents</div>
                </div>
                <div class="summary-card">
                    <div class="summary-number" style="color: #9C27B0;">24/7</div>
                    <div class="summary-label">Continuous Monitoring</div>
                </div>
            </div>
        </div>
        <div id="alerts" class="tab-content">
            <div class="controls">
                <h3 style="color: white; margin-bottom: 15px;">üö® System Alerts & Notifications</h3>
            </div>
            
            <div class="alerts-section">
                <h3 class="chart-title">Active Alerts</h3>
                <div class="alert-item alert-danger">
                    <div class="alert-icon">‚ò£Ô∏è</div>
                    <div>
                        <strong>High Contamination Zone</strong><br>
                        Groundwater Well 3: Multiple contaminants<br>
                        <small>2 hours ago</small>
                    </div>
                </div>
                <div class="alert-item alert-danger">
                    <div class="alert-icon">ü¶†</div>
                    <div>
                        <strong>Bacterial Contamination</strong><br>
                        River Station 1: E. Coli 145 CFU/100ml<br>
                        <small>30 minutes ago</small>
                    </div>
                </div>
                <div class="alert-item alert-warning">
                    <div class="alert-icon">‚ö†Ô∏è</div>
                    <div>
                        <strong>High Turbidity</strong><br>
                        Lake Monitor A: 4.2 NTU<br>
                        <small>2 hours ago</small>
                    </div>
                </div>
                <div class="alert-item alert-danger">
                    <div class="alert-icon">‚ò¢Ô∏è</div>
                    <div>
                        <strong>Metal Contamination Alert</strong><br>
                        Groundwater Well 3: Metals 18.5 Œºg/L<br>
                        <small>4 hours ago</small>
                    </div>
                </div>
                <div class="alert-item alert-warning">
                    <div class="alert-icon">üß™</div>
                    <div>
                        <strong>Chemical Contamination</strong><br>
                        Lake Monitor A: Nitrates 12.8 mg/L<br>
                        <small>5 hours ago</small>
                    </div>
                </div>
            </div>
        </div>
        <div id="settings" class="tab-content">
            <div class="report-section">
                <h3 class="chart-title">‚öôÔ∏è Dashboard Settings</h3>
                
                <div class="report-controls">
                    <div class="control-group">
                        <label>Update Frequency</label>
                        <select>
                            <option value="5">Every 5 minutes</option>
                            <option value="15" selected>Every 15 minutes</option>
                            <option value="30">Every 30 minutes</option>
                            <option value="60">Every hour</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>Alert Threshold</label>
                        <select>
                            <option value="low">Low Sensitivity</option>
                            <option value="medium" selected>Medium Sensitivity</option>
                            <option value="high">High Sensitivity</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>Temperature Unit</label>
                        <select>
                            <option value="celsius" selected>Celsius (¬∞C)</option>
                            <option value="fahrenheit">Fahrenheit (¬∞F)</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>Language</label>
                        <select>
                            <option value="en" selected>English</option>
                            <option value="hi">Hindi</option>
                        </select>
                    </div>
                </div>

                <div style="margin-top: 20px;">
                    <h4>Notification Settings</h4>
                    <div style="margin-top: 15px;">
                        <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                            <input type="checkbox" checked> Email notifications for critical alerts
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                            <input type="checkbox" checked> SMS notifications for contamination events
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                            <input type="checkbox"> Daily summary reports
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" checked> Browser push notifications
                        </label>
                    </div>
                </div>

                <div style="margin-top: 20px;">
                    <button class="report-btn">üíæ Save Settings</button>
                    <button class="report-btn" style="background: linear-gradient(45deg, #607D8B, #455A64);">üîÑ Reset to Default</button>
                </div>
            </div>
        </div>
        <div id="help" class="tab-content">
            <div class="report-section">
                <h3 class="chart-title">‚ùì Help & Documentation</h3>
                
                <div style="text-align: left;">
                    <h4 style="margin-top: 20px;">üìñ Quick Start Guide</h4>
                    <p style="margin: 10px 0;">Welcome to the Water Quality Monitoring Dashboard. This platform provides real-time monitoring of water quality parameters across Rajasthan districts.</p>
                    
                    <h4 style="margin-top: 20px;">üéØ Key Features</h4>
                    <ul style="margin: 10px 0; padding-left: 20px;">
                        <li style="margin: 8px 0;"><strong>Dashboard:</strong> View real-time water quality metrics and trends</li>
                        <li style="margin: 8px 0;"><strong>Monitoring:</strong> Track all monitoring stations across districts</li>
                        <li style="margin: 8px 0;"><strong>Reports:</strong> Generate and download detailed water quality reports</li>
                        <li style="margin: 8px 0;"><strong>Analytics:</strong> Access advanced trend analysis and insights</li>
                        <li style="margin: 8px 0;"><strong>Alerts:</strong> Receive notifications for contamination events</li>
                        <li style="margin: 8px 0;"><strong>Settings:</strong> Customize dashboard preferences</li>
                    </ul>

                    <h4 style="margin-top: 20px;">üìä Understanding Water Quality Parameters</h4>
                    <ul style="margin: 10px 0; padding-left: 20px;">
                        <li style="margin: 8px 0;"><strong>pH Level:</strong> Measures acidity/alkalinity (Safe range: 6.5-8.5)</li>
                        <li style="margin: 8px 0;"><strong>Dissolved Oxygen:</strong> Essential for aquatic life (Safe: >6 mg/L)</li>
                        <li style="margin: 8px 0;"><strong>Turbidity:</strong> Water clarity indicator (Safe: <5 NTU)</li>
                        <li style="margin: 8px 0;"><strong>E. Coli:</strong> Bacterial contamination indicator (Safe: <100 CFU/100ml)</li>
                        <li style="margin: 8px 0;"><strong>Total Metals:</strong> Heavy metal concentration (Safe: <10 Œºg/L)</li>
                        <li style="margin: 8px 0;"><strong>Nitrates:</strong> Chemical pollutant from agriculture (Safe: <10 mg/L)</li>
                    </ul>

                    <h4 style="margin-top: 20px;">üìû Contact Support</h4>
                    <p style="margin: 10px 0;">
                        Emergency Hotline: <strong>1-800-WATER-911</strong><br>
                        Email: <strong>support@waterquality.gov.in</strong><br>
                        Technical Support: Available 24/7
                    </p>

                    <h4 style="margin-top: 20px;">üîó Useful Links</h4>
                    <p style="margin: 10px 0;">
                        <a href="#" style="color: #2196F3;">User Manual (PDF)</a><br>
                        <a href="#" style="color: #2196F3;">Video Tutorials</a><br>
                        <a href="#" style="color: #2196F3;">FAQ Section</a><br>
                        <a href="#" style="color: #2196F3;">Submit Feedback</a>
                    </p>
                </div>
            </div>
        </div>
        <footer class="footer">
            <p>Water Quality Dashboard ¬© 2024 | Data updated every 15 minutes | Emergency hotline: 1-800-WATER-911</p>
        </footer>
    </div>

    <script>
        // This function ensures all HTML is loaded before running any JavaScript
        document.addEventListener('DOMContentLoaded', () => {
        
            // --- NEW: MENU AND TAB SWITCHING LOGIC ---
            const menuToggle = document.getElementById('menu-toggle');
            const menu = document.getElementById('main-menu');
            const menuItems = document.querySelectorAll('.menu-item');
            const tabContents = document.querySelectorAll('.tab-content');
            const dashboardTitle = document.getElementById('dashboard-title'); // Get the h1

            // 1. Toggle the menu on button click
            menuToggle.addEventListener('click', (e) => {
                e.stopPropagation(); // Stop click from bubbling to the window
                menu.classList.toggle('show');
            });

            // 2. Handle menu item clicks
            menuItems.forEach(clickedItem => {
                clickedItem.addEventListener('click', () => {
                    const tabName = clickedItem.dataset.tab;
                    const tabTitle = clickedItem.dataset.title;

                    // Hide all content
                    tabContents.forEach(content => content.classList.remove('active'));
                    
                    // Show selected content
                    const selectedTab = document.getElementById(tabName);
                    if (selectedTab) {
                        selectedTab.classList.add('active');
                    }
                    
                    // Update the dashboard title
                    if (dashboardTitle) {
                        dashboardTitle.textContent = tabTitle;
                    }

                    // Hide the menu
                    menu.classList.remove('show');
                    
                    // (Handle analytics chart init)
                    if (tabName === 'analytics' && !window.analyticsChartInitialized) {
                        setTimeout(() => {
                            initializeAnalyticsChart();
                            window.analyticsChartInitialized = true;
                        }, 100);
                    }
                });
            });

            // 3. Click outside to close the menu
            window.addEventListener('click', (e) => {
                if (!menu.contains(e.target) && e.target !== menuToggle) {
                    menu.classList.remove('show');
                }
            });

            // --- ALL OTHER JS FUNCTIONS ---

            // Initialize analytics chart
            function initializeAnalyticsChart() {
                const ctx = document.getElementById('analyticsChart');
                if (!ctx) return;
                
                const chartCtx = ctx.getContext('2d');
                new Chart(chartCtx, {
                    type: 'line',
                    data: {
                        labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
                        datasets: [{
                            label: 'Water Quality Index',
                            data: [65, 70, 75, 78],
                            borderColor: '#4CAF50',
                            backgroundColor: 'rgba(76, 175, 80, 0.1)',
                            tension: 0.4,
                            fill: true
                        }, {
                            label: 'Compliance Rate %',
                            data: [70, 75, 80, 85],
                            borderColor: '#2196F3',
                            backgroundColor: 'rgba(33, 150, 243, 0.1)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'top',
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100
                            }
                        }
                    }
                });
            }

            // Report generation functions
            function generateReport(event) {
                const reportType = document.getElementById('reportType').value;
                const location = document.getElementById('reportLocation').value;
                const period = document.getElementById('reportPeriod').value;
                const format = document.getElementById('reportFormat').value;
                
                const preview = document.getElementById('previewContent');
                const reportTitle = document.getElementById('reportTitle');
                const reportDate = document.getElementById('reportDate');
                const reportStats = document.getElementById('reportStats');
                
                // Update report details
                const locationText = location === 'all' ? 'All Districts' : location.charAt(0).toUpperCase() + location.slice(1) + ' District';
                reportTitle.textContent = `${reportType.charAt(0).toUpperCase() + reportType.slice(1)} Report for ${locationText}`;
                reportDate.textContent = `Generated on: ${new Date().toLocaleDateString()} at ${new Date().toLocaleTimeString()}`;
                
                // Generate sample report content
                let reportContent = '';
                switch(reportType) {
                    case 'summary':
                        reportContent = `
                            <h4>Executive Summary</h4>
                            <p><strong>Overall Water Quality Status:</strong> ${location === 'all' ? 'Moderate' : getDistrictStatus(location)}</p>
                            <p><strong>Key Findings:</strong></p>
                            <ul style="text-align: left; margin: 10px 0;">
                                <li>pH levels within acceptable range in 80% of monitoring points</li>
                                <li>E. Coli contamination detected in 3 districts</li>
                                <li>Heavy metal levels elevated in Kota district</li>
                                <li>Overall compliance rate: 75%</li>
                            </ul>
                        `;
                        break;
                    case 'contamination':
                        reportContent = `
                            <h4>Contamination Analysis</h4>
                            <p><strong>High Risk Areas:</strong> Kota District</p>
                            <p><strong>Contamination Types Detected:</strong></p>
                            <ul style="text-align: left; margin: 10px 0;">
                                <li>Bacterial contamination: E. Coli above 100 CFU/100ml</li>
                                <li>Heavy metals: Above 15 Œºg/L threshold</li>
                                <li>Chemical pollutants: Nitrates exceeding safe limits</li>
                            </ul>
                            <p><strong>Immediate Actions Required:</strong> Water treatment intervention needed</p>
                        `;
                        break;
                    default:
                        reportContent = `
                            <h4>${reportType.charAt(0).toUpperCase() + reportType.slice(1)} Report</h4>
                            <p>Comprehensive water quality analysis for the selected parameters and time period.</p>
                            <p><strong>Data Points Analyzed:</strong> 1,250</p>
                            <p><strong>Compliance Rate:</strong> 75%</p>
                            <p><strong>Action Items:</strong> 8 high priority, 15 medium priority</p>
                        `;
                }
                
                reportStats.innerHTML = reportContent;
                preview.style.display = 'block';
                
                // Show success message
                const btn = event.target;
                const originalText = btn.innerHTML;
                btn.innerHTML = '‚úÖ Report Generated';
                btn.style.background = 'linear-gradient(45deg, #4CAF50, #45a049)';
                
                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.style.background = 'linear-gradient(45deg, #2196F3, #1976D2)';
                }, 2000);
            }
            
            function downloadReport(event) {
                const format = document.getElementById('reportFormat').value;
                const location = document.getElementById('reportLocation').value;
                
                // Simulate download
                const btn = event.target;
                const originalText = btn.innerHTML;
                btn.innerHTML = `üì• Downloading ${format.toUpperCase()}...`;
                
                setTimeout(() => {
                    btn.innerHTML = '‚úÖ Downloaded Successfully';
                    btn.style.background = 'linear-gradient(45deg, #4CAF50, #45a049)';
                    
                    setTimeout(() => {
                        btn.innerHTML = originalText;
                        btn.style.background = 'linear-gradient(45deg, #4CAF50, #45a049)';
                    }, 2000);
                }, 1500);
            }
            
            function emailReport(event) {
                const btn = event.target;
                const originalText = btn.innerHTML;
                btn.innerHTML = 'üì§ Sending Email...';
                
                setTimeout(() => {
                    btn.innerHTML = '‚úÖ Email Sent';
                    btn.style.background = 'linear-gradient(45deg, #4CAF50, #45a049)';
                    
                    setTimeout(() => {
                        btn.innerHTML = originalText;
                        btn.style.background = 'linear-gradient(45deg, #FF9800, #F57C00)';
                    }, 2000);
                }, 2000);
            }
            
            function getDistrictStatus(district) {
                const statuses = {
                    'jaipur': 'Good',
                    'jodhpur': 'Fair', 
                    'udaipur': 'Excellent',
                    'kota': 'Poor',
                    'ajmer': 'Good',
                    'bikaner': 'Fair'
                };
                return statuses[district] || 'Moderate';
            }

            // Generate sample data
            function generateTrendData() {
                const labels = [];
                const phData = [];
                const oxygenData = [];
                const turbidityData = [];
                const tempData = [];
                const ecoliData = [];
                const metalsData = [];
                const nitratesData = [];

                for (let i = 6; i >= 0; i--) {
                    const date = new Date();
                    date.setDate(date.getDate() - i);
                    labels.push(date.toLocaleDateString());
                    
                    // Generate realistic water quality data with some variation
                    phData.push(7.0 + Math.random() * 0.8);
                    oxygenData.push(8.0 + Math.random() * 2.0);
                    turbidityData.push(1.0 + Math.random() * 3.0);
                    tempData.push(18.0 + Math.random() * 8.0);
                    ecoliData.push(Math.random() * 100);
                    metalsData.push(Math.random() * 10);
                    nitratesData.push(5.0 + Math.random() * 8.0);
                }

                return { labels, phData, oxygenData, turbidityData, tempData, ecoliData, metalsData, nitratesData };
            }

            // Refresh data function
            function refreshData() {
                const refreshIcon = document.getElementById('refreshIcon');
                if (!refreshIcon) return;
                
                refreshIcon.innerHTML = '‚ü≥';
                refreshIcon.classList.add('loading');
                
                // Simulate data refresh
                setTimeout(() => {
                    // Update metric values with new simulated data
                    document.getElementById('phValue').textContent = (7.0 + Math.random() * 0.8).toFixed(1);
                    document.getElementById('oxygenValue').textContent = (8.0 + Math.random() * 2.0).toFixed(1);
                    document.getElementById('turbidityValue').textContent = (1.0 + Math.random() * 3.0).toFixed(1);
                    document.getElementById('tempValue').textContent = (18.0 + Math.random() * 8.0).toFixed(1);
                    
                    // Update contamination parameters
                    document.getElementById('ecoliValue').textContent = Math.floor(Math.random() * 150);
                    document.getElementById('coliformValue').textContent = Math.floor(20 + Math.random() * 100);
                    document.getElementById('metalsValue').textContent = (Math.random() * 15).toFixed(1);
                    document.getElementById('nitratesValue').textContent = (5.0 + Math.random() * 8.0).toFixed(1);
                    
                    refreshIcon.innerHTML = 'üîÑ';
                    refreshIcon.classList.remove('loading');
                    
                    // Show success message
                    const btn = document.querySelector('.refresh-btn');
                    const originalText = btn.innerHTML;
                    btn.innerHTML = '‚úÖ Data Updated';
                    btn.style.background = 'linear-gradient(45deg, #4CAF50, #45a049)';
                    
                    setTimeout(() => {
                        btn.innerHTML = originalText;
                        btn.style.background = 'linear-gradient(45deg, #4CAF50, #45a049)';
                    }, 2000);
                }, 1500);
            }
            
            // Function to update status indicators based on current values
            function updateStatusIndicators() {
                // Check if we're on the dashboard tab
                const dashboardTab = document.getElementById('dashboard');
                if (!dashboardTab || !dashboardTab.classList.contains('active')) {
                    return;
                }
                
                const indicators = document.querySelectorAll('.status-indicator');
                if (indicators.length === 0) return;
                
                const phValue = document.getElementById('phValue');
                const oxygenValue = document.getElementById('oxygenValue');
                const turbidityValue = document.getElementById('turbidityValue');
                const tempValue = document.getElementById('tempValue');
                const ecoliValue = document.getElementById('ecoliValue');
                const coliformValue = document.getElementById('coliformValue');
                const metalsValue = document.getElementById('metalsValue');
                const nitratesValue = document.getElementById('nitratesValue');
                
                // Only proceed if elements exist
                if (!phValue || !ecoliValue || !metalsValue) return;
                
                const values = [
                    parseFloat(phValue.textContent),
                    parseFloat(oxygenValue ? oxygenValue.textContent : 0),
                    parseFloat(turbidityValue ? turbidityValue.textContent : 0),
                    parseFloat(tempValue ? tempValue.textContent : 0),
                    parseInt(ecoliValue.textContent),
                    parseInt(coliformValue ? coliformValue.textContent : 0),
                    parseFloat(metalsValue.textContent),
                    parseFloat(nitratesValue ? nitratesValue.textContent : 0)
                ];
                
                // pH indicator
                if (indicators[0]) {
                    if (values[0] >= 6.5 && values[0] <= 8.5) {
                        indicators[0].className = 'status-indicator status-safe';
                    } else if ((values[0] >= 6.0 && values[0] < 6.5) || (values[0] > 8.5 && values[0] <= 9.0)) {
                        indicators[0].className = 'status-indicator status-caution';
                    } else {
                        indicators[0].className = 'status-indicator status-danger';
                    }
                }
                
                // E. Coli indicator
                if (indicators[4]) {
                    if (values[4] <= 100) {
                        indicators[4].className = 'status-indicator status-safe';
                    } else if (values[4] <= 200) {
                        indicators[4].className = 'status-indicator status-caution';
                    } else {
                        indicators[4].className = 'status-indicator status-danger';
                    }
                }
                
                // Total Metals indicator
                if (indicators[6]) {
                    if (values[6] <= 10) {
                        indicators[6].className = 'status-indicator status-safe';
                    } else if (values[6] <= 15) {
                        indicators[6].className = 'status-indicator status-caution';
                    } else {
                        indicators[6].className = 'status-indicator status-danger';
                    }
                }
                
                // Check for high-contamination zones and trigger alerts
                checkHighContaminationZones();
            }
            
            // Function to check and alert for high-contamination zones
            function checkHighContaminationZones() {
                const ecoliLevel = parseInt(document.getElementById('ecoliValue').textContent);
                const metalsLevel = parseFloat(document.getElementById('metalsValue').textContent);
                const nitratesLevel = parseFloat(document.getElementById('nitratesValue').textContent);
                
                // High contamination zone criteria: multiple parameters above threshold
                const highContamination = (ecoliLevel > 100) + (metalsLevel > 15) + (nitratesLevel > 10);
                
                if (highContamination >= 2) {
                    console.log('üö® HIGH CONTAMINATION ZONE DETECTED!');
                    // In a real application, this would trigger notifications/alerts
                }
            }
            
            // --- INITIALIZE CHARTS ---

            // Create trends chart
            const trendsCtx = document.getElementById('trendsChart').getContext('2d');
            const trendData = generateTrendData();

            new Chart(trendsCtx, {
                type: 'line',
                data: {
                    labels: trendData.labels,
                    datasets: [{
                        label: 'pH Level',
                        data: trendData.phData,
                        borderColor: '#2196F3',
                        backgroundColor: 'rgba(33, 150, 243, 0.1)',
                        tension: 0.4,
                        fill: false,
                        yAxisID: 'y'
                    }, {
                        label: 'Dissolved Oxygen',
                        data: trendData.oxygenData,
                        borderColor: '#4CAF50',
                        backgroundColor: 'rgba(76, 175, 80, 0.1)',
                        tension: 0.4,
                        fill: false,
                        yAxisID: 'y'
                    }, {
                        label: 'Turbidity',
                        data: trendData.turbidityData,
                        borderColor: '#FF9800',
                        backgroundColor: 'rgba(255, 152, 0, 0.1)',
                        tension: 0.4,
                        fill: false,
                        yAxisID: 'y'
                    }, {
                        label: 'E. Coli (CFU/100ml)',
                        data: trendData.ecoliData,
                        borderColor: '#9C27B0',
                        backgroundColor: 'rgba(156, 39, 176, 0.1)',
                        tension: 0.4,
                        fill: false,
                        yAxisID: 'y1'
                    }, {
                        label: 'Total Metals (Œºg/L)',
                        data: trendData.metalsData,
                        borderColor: '#795548',
                        backgroundColor: 'rgba(121, 85, 72, 0.1)',
                        tension: 0.4,
                        fill: false,
                        yAxisID: 'y1'
                    }]
                },
                options: {
                    responsive: true,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            callbacks: {
                                afterLabel: function(context) {
                                    if (context.dataset.label === 'E. Coli (CFU/100ml)') {
                                        return context.parsed.y > 100 ? '‚ö†Ô∏è Above safe limit' : '‚úÖ Safe level';
                                    }
                                    if (context.dataset.label === 'Total Metals (Œºg/L)') {
                                        return context.parsed.y > 15 ? 'üö® Dangerous level' : '‚úÖ Safe level';
                                    }
                                    return '';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'pH, DO, Turbidity'
                            },
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'Contamination Levels'
                            },
                            grid: {
                                drawOnChartArea: false,
                            },
                        },
                        x: {
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            }
                        }
                    }
                }
            });

            // Create distribution chart
            const distributionCtx = document.getElementById('distributionChart').getContext('2d');
            new Chart(distributionCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Excellent (90-100)', 'Good (70-89)', 'Fair (50-69)', 'Poor (0-49)'],
                    datasets: [{
                        data: [25, 45, 20, 10],
                        backgroundColor: [
                            '#4CAF50',
                            '#8BC34A', 
                            '#FF9800',
                            '#F44336'
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20
                            }
                        }
                    }
                }
            });

            // Create location-based bar chart for water test results
            const locationCtx = document.getElementById('locationChart').getContext('2d');
            new Chart(locationCtx, {
                type: 'bar',
                data: {
                    labels: ['Jaipur', 'Jodhpur', 'Udaipur', 'Kota', 'Ajmer', 'Bikaner'],
                    datasets: [{
                        label: 'pH Level',
                        data: [7.2, 8.1, 7.4, 6.1, 7.6, 8.3],
                        backgroundColor: 'rgba(33, 150, 243, 0.8)',
                        borderColor: '#2196F3',
                        borderWidth: 1
                    }, {
                        label: 'Dissolved Oxygen',
                        data: [8.8, 7.2, 9.1, 5.8, 8.4, 6.8],
                        backgroundColor: 'rgba(76, 175, 80, 0.8)',
                        borderColor: '#4CAF50',
                        borderWidth: 1
                    }, {
                        label: 'E. Coli (CFU/100ml √∑ 10)',
                        data: [2.5, 8.0, 0.8, 18.5, 4.5, 9.5],
                        backgroundColor: 'rgba(156, 39, 176, 0.8)',
                        borderColor: '#9C27B0',
                        borderWidth: 1
                    }, {
                        label: 'Total Metals',
                        data: [2.8, 5.2, 0.8, 16.8, 3.5, 7.8],
                        backgroundColor: 'rgba(121, 85, 72, 0.8)',
                        borderColor: '#795548',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            callbacks: {
                                afterLabel: function(context) {
                                    if (context.dataset.label === 'E. Coli (CFU/100ml √∑ 10)') {
                                        const actualValue = context.parsed.y * 10;
                                        return `Actual E. Coli: ${actualValue} CFU/100ml`;
                                    }
                                    if (context.dataset.label === 'Total Metals' && context.parsed.y > 15) {
                                        return 'üö® High contamination zone!';
                                    }
                                    return '';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Parameter Values'
                            }
                        }
                    }
                }
            });

            // --- ADD EVENT LISTENERS TO BUTTONS ---
            document.querySelector('.refresh-btn').addEventListener('click', refreshData);
            
            // Add listeners for report buttons
            const reportButtons = document.querySelectorAll('#reports .report-btn');
            if (reportButtons.length >= 3) {
                reportButtons[0].addEventListener('click', generateReport);
                reportButtons[1].addEventListener('click', downloadReport);
                reportButtons[2].addEventListener('click', emailReport);
            }

            // Auto-refresh every 5 minutes
            setInterval(() => {
                console.log('Auto-refreshing data...');
                // Only refresh if dashboard tab is active
                const dashboardTab = document.getElementById('dashboard');
                if (dashboardTab && dashboardTab.classList.contains('active')) {
                    refreshData();
                }
            }, 300000);

            // Event listeners for controls
            document.getElementById('locationSelect').addEventListener('change', function() {
                console.log('Location changed to:', this.value);
                // Here you would typically filter data based on selected location
            });

            document.getElementById('timeRange').addEventListener('change', function() {
                console.log('Time range changed to:', this.value);
                // Here you would typically update charts with new time range
            });

            // Simulate real-time updates
            setInterval(() => {
                // Only update if dashboard tab is active
                const dashboardTab = document.getElementById('dashboard');
                if (!dashboardTab || !dashboardTab.classList.contains('active')) {
                    return;
                }
                
                // Slightly adjust metric values to simulate real-time changes
                const phElement = document.getElementById('phValue');
                if (phElement) {
                    const currentPh = parseFloat(phElement.textContent);
                    const newPh = Math.max(6.0, Math.min(8.5, currentPh + (Math.random() - 0.5) * 0.1));
                    phElement.textContent = newPh.toFixed(1);
                }
                
                const oxygenElement = document.getElementById('oxygenValue');
                if (oxygenElement) {
                    const currentOxygen = parseFloat(oxygenElement.textContent);
                    const newOxygen = Math.max(5.0, Math.min(12.0, currentOxygen + (Math.random() - 0.5) * 0.2));
                    oxygenElement.textContent = newOxygen.toFixed(1);
                }
                
                // Update contamination parameters with realistic variations
                const ecoliElement = document.getElementById('ecoliValue');
                if (ecoliElement) {
                    const currentEcoli = parseInt(ecoliElement.textContent);
                    const newEcoli = Math.max(0, Math.min(200, currentEcoli + Math.floor((Math.random() - 0.5) * 10)));
                    ecoliElement.textContent = newEcoli;
                }
                
                const metalsElement = document.getElementById('metalsValue');
                if (metalsElement) {
                    const currentMetals = parseFloat(metalsElement.textContent);
                    const newMetals = Math.max(0, Math.min(20, currentMetals + (Math.random() - 0.5) * 0.5));
                    metalsElement.textContent = newMetals.toFixed(1);
                }
                
                // Update status indicators based on contamination levels
                updateStatusIndicators();
            }, 30000); // Update every 30 seconds
            
            
            // --- INITIAL PAGE SETUP ---
            
            // Initialize date inputs
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('dateFrom').value = new Date(Date.now() - 7*24*60*60*1000).toISOString().split('T')[0];
            document.getElementById('dateTo').value = today;

            console.log('Water Quality Dashboard initialized successfully!');
        
        }); // End of DOMContentLoaded
    </script>
</body>
</html>